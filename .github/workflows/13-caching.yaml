name: 13-caching
on: 
    push:
        branches: 
            - main
    workflow_dispatch:
        inputs:
            use-cache:
                type: boolean
                description: "use cache"
                default: true

defaults:
   run: 
         working-directory: react-app

jobs:
    checkout:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v3
              with:
                    node-version: '20.x'  # ✅ Use a stable version
                    cache: 'npm'  # ✅ GitHub Actions' built-in caching

            - name: Cache dependencies
              id: cache
              uses: actions/cache@v4
              with:
                    path: node_modules  # ✅ Cache node_modules instead
                    key: ${{ runner.os }}-node-modules-${{ hashFiles('**/package-lock.json') }}
                    restore-keys: |
                        ${{ runner.os }}-node-modules-

            - name: Install dependencies
              run: npm ci  # ✅ Always run npm ci to ensure node_modules exists

            - name: Build the application
              run: npm run build 

            - name: Run unit tests
              run: npm run test